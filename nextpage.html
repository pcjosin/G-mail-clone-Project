<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://apis.google.com/js/client.js"></script>
  <script async defer src="https://apis.google.com/js/api.js"></script>
    <script async defer src="https://accounts.google.com/gsi/client" ></script>
  <title>Next Page</title>
</head>
<body>

<!-- Content for Next Page -->
<h1>Welcome to the Next Page</h1>
<pre id="nextpage-content" style="white-space: pre-wrap;"></pre>

<script type="text/javascript">


const apiKey = sessionStorage.getItem('gapiKey');
const clientId = sessionStorage.getItem('gapiClientId');
const discoveryDocs = JSON.parse(sessionStorage.getItem('gapiDiscoveryDocs'));
const scope = sessionStorage.getItem('gapiScope');

// Reconstruct gapi.client



const storedClient = sessionStorage.getItem('gapiClient');
const restoredClient = JSON.parse(storedClient);
const API_KEY = 'AIzaSyAGzP3_IUN8Ds05jBNckdYrFR6jyDeoeEo';


  // Initialize the Gmail API client on the Next Page
  const accessToken = localStorage.getItem('accessToken');

  // Initialize the Gmail API client on the Next Page
  gapi.load('client', () => {
    gapi.client.init({
      apiKey: API_KEY,
      discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest'],
    }).then(() => {
      // Set the access token in gapi.client
      if (accessToken) {
        gapi.client.setToken({ access_token: accessToken });

        // Call the listLabels function
        listLabels();
      } else {
        document.getElementById('nextpage-content').innerText = 'Access token not found.';
      }
    });
  });

  // Function to list labels
  async function listLabels() {
    let response;
    try {
      response = await gapi.client.gmail.users.labels.list({
        'userId': 'me',
      });
    } catch (err) {
      document.getElementById('nextpage-content').innerText = err.message;
      return;
    }
    const labels = response.result.labels;
    if (!labels || labels.length == 0) {
      document.getElementById('nextpage-content').innerText = 'No labels found.';
      return;
    }
    // Flatten to string to display
    const output = labels.reduce(
      (str, label) => `${str}${label.name}\n`,
      'Labels:\n');
    document.getElementById('nextpage-content').innerText = output;
  }
    listLabels()
</script>
</body>
</html>
